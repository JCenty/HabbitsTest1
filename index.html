<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SiÅ‚ownia Tracker</title>
  <!-- MoÅ¼liwoÅ›Ä‡ dodania jako aplikacja na ekranie -->
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      font-family: sans-serif;
      max-width: 400px;
      margin: auto;
      padding: 20px;
    }
    .habit {
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
    .stats {
      margin-top: 30px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>SiÅ‚ownia Tracker ğŸ’ª</h1>

  <!-- Sekcja gÅ‚Ã³wna z akcjÄ… -->
  <div class="habit">
    <p>DziÅ›: <span id="today-date"></span></p>
    <button id="mark-btn">âœ… Zaznacz, Å¼e byÅ‚em na siÅ‚owni</button>
    <p id="status"></p>
  </div>

  <!-- Sekcja statystyk -->
  <div class="stats">
    <p>ğŸ“Š SiÅ‚a: <span id="strength"></span> pkt</p>
    <p>ğŸ—“ï¸ Akcje w tym tygodniu: <span id="weekly-count"></span></p>
    <p>ğŸ“… Ostatnia aktualizacja: <span id="last-update"></span></p>
  </div>

  <script>
    const STORAGE_KEY = "gym-tracker-data"; // Klucz do localStorage
    const today = new Date().toISOString().split("T")[0]; // Dzisiejsza data (np. 2025-05-10)

    // DomyÅ›lne dane, jeÅ›li aplikacja uruchamiana pierwszy raz
    const defaultData = {
      strength: 10,        // PoczÄ…tkowa wartoÅ›Ä‡ siÅ‚y
      actions: {},         // Obiekt przechowujÄ…cy wykonane akcje wg daty
      lastUpdatedWeek: null, // Ostatni tydzieÅ„, dla ktÃ³rego zaktualizowano siÅ‚Ä™
    };

    // Wczytanie danych z localStorage lub przyjÄ™cie domyÅ›lnych
    let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultData;

    // Pobranie elementÃ³w HTML
    document.getElementById("today-date").textContent = today;
    const markBtn = document.getElementById("mark-btn");
    const statusEl = document.getElementById("status");
    const strengthEl = document.getElementById("strength");
    const weeklyCountEl = document.getElementById("weekly-count");
    const lastUpdateEl = document.getElementById("last-update");

    // Funkcja obliczajÄ…ca numer tygodnia z daty (np. tydzieÅ„ 19)
    function getWeekNumber(date) {
      const d = new Date(date);
      d.setHours(0, 0, 0, 0); // zerujemy godziny
      d.setDate(d.getDate() + 4 - (d.getDay() || 7)); // przestawiamy na czwartek w tym tygodniu
      const yearStart = new Date(d.getFullYear(), 0, 1);
      return Math.ceil(((d - yearStart) / 86400000 + 1) / 7); // obliczamy tydzieÅ„
    }

    // Funkcja zwracajÄ…ca bieÅ¼Ä…cy numer tygodnia
    function getCurrentWeek() {
      return getWeekNumber(today);
    }

    // Funkcja liczÄ…ca liczbÄ™ wykonanych akcji w danym tygodniu
    function getWeekActionsCount(week) {
      return Object.keys(data.actions).filter(date => getWeekNumber(date) === week).length;
    }

    // Funkcja aktualizujÄ…ca siÅ‚Ä™ raz na tydzieÅ„ (przy zmianie tygodnia)
    function updateStrengthIfNewWeek() {
      const currentWeek = getCurrentWeek();
      if (data.lastUpdatedWeek !== currentWeek) {
        const lastWeek = currentWeek - 1;
        const count = getWeekActionsCount(lastWeek);

        // Zasady aktualizacji siÅ‚y:
        if (count === 0) data.strength = Math.max(0, data.strength - 1); // minimalna siÅ‚a to 0
        else if (count > 1) data.strength += (count - 1); // bonus za wiÄ™cej niÅ¼ 1 akcjÄ™

        data.lastUpdatedWeek = currentWeek;
        saveData(); // zapisujemy zmiany
      }
    }

    // Funkcja zapisujÄ…ca dane do localStorage
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      render(); // odÅ›wieÅ¼ widok
    }

    // Funkcja aktualizujÄ…ca widok aplikacji
    function render() {
      const markedToday = !!data.actions[today]; // sprawdzamy czy dziÅ› akcja juÅ¼ zostaÅ‚a zaznaczona

      // Zmieniamy tekst przycisku zaleÅ¼nie od tego, czy zaznaczono
      markBtn.textContent = markedToday
        ? "âŒ Cofnij zaznaczenie"
        : "âœ… Zaznacz, Å¼e byÅ‚em na siÅ‚owni";

      // Komunikat statusu
      statusEl.textContent = markedToday
        ? "âœ… JuÅ¼ zaznaczyÅ‚eÅ› dzisiejszÄ… akcjÄ™."
        : "âŒ Nie zaznaczyÅ‚eÅ› dzisiejszej akcji.";

      // Aktualizacja danych w interfejsie
      strengthEl.textContent = data.strength;
      weeklyCountEl.textContent = getWeekActionsCount(getCurrentWeek());
      lastUpdateEl.textContent = `TydzieÅ„ ${data.lastUpdatedWeek || "-"}`;
    }

    // ObsÅ‚uga klikniÄ™cia przycisku
    markBtn.addEventListener("click", () => {
      if (data.actions[today]) {
        delete data.actions[today]; // cofamy zaznaczenie
      } else {
        data.actions[today] = true; // zaznaczamy akcjÄ™ na dziÅ›
      }
      saveData(); // zapisujemy dane i odÅ›wieÅ¼amy widok
    });

    // Inicjalizacja: sprawdÅº, czy zaczÄ…Å‚ siÄ™ nowy tydzieÅ„
    updateStrengthIfNewWeek();
    render(); // wyÅ›wietl aktualne dane
  </script>
</body>
</html>

